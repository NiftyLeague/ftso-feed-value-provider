# =============================================================================
# FTSO VALUE PROVIDER - ENVIRONMENT CONFIGURATION
# =============================================================================
# This file contains all available environment variables with their default values.
# Copy this file to .env and modify the values as needed for your environment.
#
# Variable Naming Convention: [SECTION]_[SUBSECTION]_[SETTING]_[UNIT]
# Example: CACHE_WARMER_INTERVAL_MS, RETRY_HTTP_MAX_DELAY_MS
# =============================================================================

# =============================================================================
# APPLICATION SETTINGS
# =============================================================================

# Node.js environment (development, production, test)
NODE_ENV=production

# Application server configuration
APP_PORT=3101
APP_BASE_PATH=""
APP_CORS_MAX_AGE=3600

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================

# Log level (error, warn, log, debug, verbose)
LOG_LEVEL=log
LOG_FORMAT=json
LOG_DIRECTORY=logs

# Logging features
ENABLE_FILE_LOGGING=false
ENABLE_PERFORMANCE_LOGGING=false
ENABLE_DEBUG_LOGGING=false
ENABLE_AUDIT_LOGGING=true

# Log file management
MAX_LOG_FILE_SIZE=10MB
MAX_LOG_FILES=5
PERFORMANCE_LOG_THRESHOLD=100
DEBUG_LOG_LEVEL=debug
ERROR_LOG_RETENTION_DAYS=30
MAX_ERROR_HISTORY_SIZE=1000

# Log content options
INCLUDE_TIMESTAMP=true
INCLUDE_CONTEXT=true
INCLUDE_STACK_TRACE=true

# =============================================================================
# DATA FRESHNESS & QUALITY
# =============================================================================

# Data freshness thresholds (milliseconds)
DATA_FRESH_THRESHOLD_MS=2000
DATA_MAX_AGE_MS=20000
DATA_STALE_WARNING_MS=10000

# Data quality validation thresholds
DATA_QUALITY_OUTLIER_THRESHOLD=0.05
DATA_QUALITY_CONSENSUS_THRESHOLD=0.005
DATA_QUALITY_Z_SCORE_THRESHOLD=2.5
DATA_QUALITY_STALENESS_WARNING_THRESHOLD=0.8

# Confidence penalties (0.0 - 1.0)
DATA_QUALITY_CONFIDENCE_HIGH_PENALTY=0.5
DATA_QUALITY_CONFIDENCE_MEDIUM_PENALTY=0.8
DATA_QUALITY_CONFIDENCE_SMALL_PENALTY=0.95

# Cross-source validation
DATA_QUALITY_CROSS_SOURCE_THRESHOLD=0.02
DATA_QUALITY_CROSS_SOURCE_WARNING_MULTIPLIER=2.0
DATA_QUALITY_CONSENSUS_WARNING_MULTIPLIER=2.0

# Data validation settings
DATA_QUALITY_MIN_HISTORICAL_POINTS=3
DATA_QUALITY_RECENT_PRICES_WINDOW=5
DATA_QUALITY_MAX_HIGH_ERRORS=1

# Data processing configuration
DATA_QUALITY_CROSS_SOURCE_WINDOW_MS=10000
DATA_QUALITY_MAX_BATCH_SIZE=100
DATA_QUALITY_HISTORICAL_WINDOW=50
DATA_QUALITY_CONSENSUS_WEIGHT=0.8
DATA_QUALITY_PRICE_RANGE_MIN=0.01
DATA_QUALITY_PRICE_RANGE_MAX=1000000
DATA_QUALITY_CACHE_SIZE=1000
DATA_QUALITY_CACHE_TTL_MS=5000

# Unified confidence penalties
DATA_QUALITY_CONFIDENCE_PENALTY_CRITICAL=0.1
DATA_QUALITY_CONFIDENCE_PENALTY_HIGH=0.3
DATA_QUALITY_CONFIDENCE_PENALTY_MEDIUM=0.6

# =============================================================================
# RATE LIMITING
# =============================================================================

RATE_LIMIT_MAX_REQUESTS=1000
RATE_LIMIT_WINDOW_MS=60000

# =============================================================================
# TIMEOUT CONFIGURATION
# =============================================================================

# Application lifecycle timeouts (milliseconds)
GRACEFUL_SHUTDOWN_TIMEOUT_MS=30000
APP_READINESS_TIMEOUT_MS=30000
INTEGRATION_SERVICE_TIMEOUT_MS=60000
HEALTH_CHECK_TIMEOUT_MS=3000
LIVENESS_CHECK_TIMEOUT_MS=2000

# Network operation timeouts
HTTP_TIMEOUT_MS=10000
HTTP_RECOVERY_TIMEOUT_MS=30000
DB_TIMEOUT_MS=30000
DB_RECOVERY_TIMEOUT_MS=60000

# Processing operation timeouts
VALIDATION_TIMEOUT_MS=5000
WEBHOOK_TIMEOUT_MS=5000
CIRCUIT_BREAKER_TIMEOUT_MS=5000
DATA_VALIDATOR_TIMEOUT_MS=5000
CCXT_TIMEOUT_MS=10000

# Bootstrap and monitoring timeouts
READINESS_CHECK_INTERVAL_MS=1000
READINESS_REQUEST_TIMEOUT_MS=5000
CLEANUP_DELAY_MS=100
FORCE_EXIT_DELAY_MS=1000

# =============================================================================
# ERROR HANDLING & RETRY CONFIGURATION
# =============================================================================

# Error handling
ERROR_HANDLING_WARNING_COOLDOWN_MS=30000

# Default retry configuration
RETRY_DEFAULT_MAX_RETRIES=3
RETRY_DEFAULT_INITIAL_DELAY_MS=1000
RETRY_DEFAULT_MAX_DELAY_MS=30000
RETRY_DEFAULT_BACKOFF_MULTIPLIER=2.0

# Service-specific retry overrides
RETRY_HTTP_MAX_DELAY_MS=15000
RETRY_DATABASE_MAX_RETRIES=2
RETRY_DATABASE_INITIAL_DELAY_MS=500
RETRY_DATABASE_MAX_DELAY_MS=5000
RETRY_CACHE_MAX_RETRIES=1
RETRY_CACHE_INITIAL_DELAY_MS=100
RETRY_CACHE_MAX_DELAY_MS=1000
RETRY_EXTERNAL_API_INITIAL_DELAY_MS=2000
RETRY_EXTERNAL_API_MAX_DELAY_MS=30000
RETRY_WEBSOCKET_MAX_RETRIES=5
RETRY_WEBSOCKET_INITIAL_DELAY_MS=1000
RETRY_WEBSOCKET_MAX_DELAY_MS=60000

# Circuit breaker configuration
CIRCUIT_BREAKER_SUCCESS_THRESHOLD=3
CIRCUIT_BREAKER_MONITORING_WINDOW_MS=300000

# =============================================================================
# CONNECTION RECOVERY
# =============================================================================

CONNECTION_RECOVERY_MAX_FAILOVER_TIME_MS=100
CONNECTION_RECOVERY_RECONNECT_DELAY_MS=10000
CONNECTION_RECOVERY_MAX_RECONNECT_DELAY_MS=60000
CONNECTION_RECOVERY_MAX_RECONNECT_ATTEMPTS=5
CONNECTION_RECOVERY_GRACEFUL_DEGRADATION_THRESHOLD=2
CONNECTION_RECOVERY_RECONNECT_COOLDOWN_MS=30000

# =============================================================================
# ALERT THRESHOLDS
# =============================================================================

ALERT_CONSENSUS_DEVIATION_CRITICAL=1.0
ALERT_CONSENSUS_DEVIATION_ERROR=0.5
ALERT_ACCURACY_RATE_LOW=80
ALERT_CONNECTION_RATE_LOW=90
ALERT_ERROR_RATE_HIGH=5
ALERT_QUALITY_SCORE_LOW=70

# =============================================================================
# SYSTEM RESOURCES & PERFORMANCE
# =============================================================================

# Memory thresholds (0.0 - 1.0)
SYSTEM_MEMORY_CRITICAL_THRESHOLD=0.95
SYSTEM_MEMORY_WARNING_THRESHOLD=0.85
SYSTEM_FREE_MEMORY_CRITICAL_THRESHOLD=0.1

# Node.js version requirements
SYSTEM_MIN_NODE_VERSION=16
SYSTEM_RECOMMENDED_NODE_VERSION=18

# System monitoring
SYSTEM_MONITORING_ENABLED=true

# =============================================================================
# CACHE SYSTEM CONFIGURATION
# =============================================================================

# Core cache settings
CACHE_TTL_MS=2000
CACHE_MAX_ENTRIES=25000
CACHE_ACCESS_UPDATE_THRESHOLD_MS=100
CACHE_EVICTION_PERCENTAGE=0.15
CACHE_MAX_EVICTION_COUNT=200
CACHE_FRESHNESS_CHECK_MS=200

# Buffer and warmup settings
CACHE_MAX_BUFFER_SIZE=100
CACHE_WARMUP_INTERVAL_MS=120000
CACHE_STALE_PATTERN_THRESHOLD_MS=86400000
CACHE_ACTIVE_PATTERN_THRESHOLD_MS=3600000

# Performance targets
CACHE_HIT_RATE_TARGET=0.95
CACHE_RESPONSE_TIME_P95_TARGET_MS=500
CACHE_MEMORY_LIMIT_MB=500
CACHE_MIN_REQUESTS_FOR_HIT_RATE=10
CACHE_MIN_REQUESTS_FOR_RESPONSE_TIME=5

# Cache warmer configuration
CACHE_WARMER_AGGRESSIVE_INTERVAL_MS=60000
CACHE_WARMER_PREDICTIVE_INTERVAL_MS=120000
CACHE_WARMER_MAINTENANCE_INTERVAL_MS=300000
CACHE_WARMER_CRITICAL_TARGET_FEEDS=20
CACHE_WARMER_CRITICAL_CONCURRENCY=16
CACHE_WARMER_CRITICAL_INTERVAL_MS=2000
CACHE_WARMER_PREDICTIVE_TARGET_FEEDS=40
CACHE_WARMER_PREDICTIVE_CONCURRENCY=12
CACHE_WARMER_MAINTENANCE_TARGET_FEEDS=100
CACHE_WARMER_MAINTENANCE_CONCURRENCY=8
CACHE_WARMER_DEFAULT_ACCESS_INTERVAL_MS=10000
CACHE_WARMER_IMMEDIATE_THRESHOLD=3
CACHE_WARMER_FREQUENT_ACCESS_THRESHOLD_MS=30000
CACHE_WARMER_ACTIVE_PATTERN_THRESHOLD_MS=300000
CACHE_WARMER_PREDICTION_WINDOW_MS=60000

# Cache warmer priority and boost settings
CACHE_WARMER_PRIORITY_BASE_MULTIPLIER=2.5
CACHE_WARMER_RECENCY_BOOST_30MIN=3.0
CACHE_WARMER_RECENCY_BOOST_2HOUR=2.2
CACHE_WARMER_RECENCY_BOOST_8HOUR=1.6
CACHE_WARMER_FREQUENCY_BOOST_15SEC=2.2
CACHE_WARMER_FREQUENCY_BOOST_1MIN=1.8
CACHE_WARMER_CONFIDENCE_MULTIPLIER_MIN=0.3
CACHE_WARMER_CONFIDENCE_MULTIPLIER_MAX=1.7
CACHE_WARMER_DECAY_RATE_MIN_HOURS=12
CACHE_WARMER_DECAY_RATE_MAX_HOURS=48
CACHE_WARMER_VOLUME_BOOST_MAX=1.5
CACHE_WARMER_PRIORITY_MIN=0.05
CACHE_WARMER_PRIORITY_MAX=100

# =============================================================================
# HEALTH CHECKS & INTERVALS
# =============================================================================

# Health check intervals
HEALTH_CHECK_MONITORING_INTERVAL_MS=30000
HEALTH_CHECK_CONNECTION_RECOVERY_INTERVAL_MS=10000
HEALTH_CHECK_AGGREGATION_INTERVAL_MS=60000
HEALTH_CHECK_FAILOVER_INTERVAL_MS=5000

# System intervals
INTERVAL_MONITORING_MS=5000
INTERVAL_PERFORMANCE_MONITORING_MS=30000
INTERVAL_SYSTEM_CHECK_MS=120000
INTERVAL_AGGREGATION_MS=50
INTERVAL_CACHE_CLEANUP_MS=1500

# =============================================================================
# MONITORING & PERFORMANCE
# =============================================================================

# Monitoring configuration
MONITORING_ENABLED=true
MONITORING_METRICS_PORT=9090

# Data retention and cleanup
MONITORING_BUCKET_SIZE_MS=300000
MONITORING_DATA_RETENTION_MS=86400000
MONITORING_MAX_METRICS_HISTORY=10000
MONITORING_MAX_ERROR_HISTORY=1000

# Performance thresholds
MONITORING_MAX_RESPONSE_LATENCY_MS=100
MONITORING_MAX_DATA_AGE_MS=2000
MONITORING_MIN_THROUGHPUT=150
MONITORING_MIN_CACHE_HIT_RATE=90

# Health thresholds
MONITORING_MAX_ERROR_RATE=3
MONITORING_MAX_CPU_USAGE=70
MONITORING_MAX_MEMORY_USAGE=70
MONITORING_MIN_CONNECTION_RATE=95

# Accuracy thresholds
MONITORING_MAX_CONSENSUS_DEVIATION=0.5
MONITORING_MIN_ACCURACY_RATE=80
MONITORING_MIN_QUALITY_SCORE=70

# Alerting configuration
MONITORING_ALERT_COOLDOWN_MS=300000
MONITORING_ALERT_DURATION_MS=30000
MONITORING_ALERT_RETENTION_DAYS=7
MONITORING_MAX_ALERTS_LIMIT=100
MONITORING_MAX_ALERTS_PER_HOUR=20

# Warning cooldowns
MONITORING_STALE_WARNING_COOLDOWN_MS=120000
MONITORING_QUALITY_WARNING_COOLDOWN_MS=300000

# Performance monitoring
MONITORING_SLOW_RESPONSE_THRESHOLD_MS=1000
MONITORING_HIGH_ERROR_RATE_THRESHOLD=5
MONITORING_ERROR_RATE_TIME_WINDOW_MS=300000

# Additional monitoring constants
MONITORING_WARNING_THRESHOLD=0.3
MONITORING_CRITICAL_THRESHOLD=1.0
MONITORING_MAX_DEVIATION=2.0
MONITORING_MIN_PARTICIPANTS=2
MONITORING_BUFFER_SIZE=2000

# =============================================================================
# PERFORMANCE OPTIMIZATION
# =============================================================================

# Connection health ratios
PERFORMANCE_HEALTHY_CONNECTION_RATIO=0.8
PERFORMANCE_DEGRADED_CONNECTION_RATIO=0.5

# Confidence and thresholds
PERFORMANCE_DEFAULT_CONFIDENCE_FALLBACK=0.5
PERFORMANCE_MIN_CONFIDENCE_THRESHOLD=0.5
PERFORMANCE_WARN_CONFIDENCE_THRESHOLD=0.7
PERFORMANCE_PRICE_CHANGE_THRESHOLD=0.05
PERFORMANCE_STABILITY_THRESHOLD=0.05

# Retry and backoff settings
PERFORMANCE_COMMON_BACKOFF_MULTIPLIER=2.0
PERFORMANCE_JITTER_MIN_FACTOR=0.5
PERFORMANCE_JITTER_MAX_FACTOR=0.5

# Exchange adapter penalties
PERFORMANCE_MAX_LATENCY_PENALTY=0.5
PERFORMANCE_MAX_SPREAD_PENALTY=0.3
PERFORMANCE_LATENCY_THRESHOLD_MS=5000

# Optimization settings
PERFORMANCE_OPTIMIZATION_INTERVAL_MS=300000
PERFORMANCE_RESPONSE_TIME_TARGET_MS=50
PERFORMANCE_CRITICAL_RESPONSE_TIME_MS=150
PERFORMANCE_MEMORY_USAGE_THRESHOLD=60
PERFORMANCE_CPU_USAGE_THRESHOLD=50

# Calculation helpers
PERFORMANCE_SMOOTHING_ALPHA=0.1

# Cache optimization settings
PERFORMANCE_CLEANUP_TRIGGER_PROBABILITY=0.1
PERFORMANCE_MAX_ADAPTIVE_MULTIPLIER=2.0
PERFORMANCE_FREQUENCY_MULTIPLIER=0.1

# =============================================================================
# WEBSOCKET CONFIGURATION - STABILITY OPTIMIZED
# =============================================================================

# WebSocket ping/pong settings for connection health monitoring
WEBSOCKET_PING_INTERVAL_MS=30000
WEBSOCKET_PONG_TIMEOUT_MS=20000

# Connection recovery settings
WEBSOCKET_RECONNECT_DELAY_MS=5000
WEBSOCKET_MAX_RECONNECT_ATTEMPTS=5
WEBSOCKET_CONNECTION_TIMEOUT_MS=45000

# Error handling and rate limiting
WEBSOCKET_ERROR_COOLDOWN_MS=60000
WEBSOCKET_MAX_BACKOFF_MS=180000
WEBSOCKET_RATE_LIMIT_BACKOFF_BASE_MS=10000
WEBSOCKET_RATE_LIMIT_BACKOFF_MULTIPLIER=2.0

# =============================================================================
# EXCHANGE CONFIGURATION
# =============================================================================

# Base exchange adapter settings
EXCHANGE_MAX_RETRIES=3
EXCHANGE_RETRY_DELAY_MS=1000
EXCHANGE_WARNING_COOLDOWN_MS=30000

# Confidence thresholds
EXCHANGE_MIN_CONFIDENCE=0.5
EXCHANGE_WARN_CONFIDENCE=0.7

# Rate limiting for 429 errors
EXCHANGE_RATE_LIMIT_MAX_DELAY_MS=300000
EXCHANGE_RATE_LIMIT_BACKOFF_MULTIPLIER=3.0


# =============================================================================
# CCXT EXCHANGE ADAPTER
# =============================================================================

# Core CCXT settings
CCXT_RETRY_BACKOFF_MS=10000
CCXT_TRADES_LIMIT=1000
CCXT_LAMBDA_DECAY=0.00005
CCXT_ENABLE_USDT_CONVERSION=true

# CCXT confidence settings
CCXT_INITIAL_CONFIDENCE=0.8
CCXT_BASE_CONFIDENCE=0.7
CCXT_MIN_CONFIDENCE=0.1
CCXT_MAX_CONFIDENCE=1.0
CCXT_MIN_CONFIDENCE_VARIANCE=0.1
CCXT_PRICE_CONFIDENCE_BOOST=0.1
CCXT_TIMESTAMP_CONFIDENCE_BOOST=0.05

# CCXT data freshness
CCXT_MAX_DATA_AGE_MS=30000
CCXT_MAX_AGE_PENALTY=0.5
CCXT_TIMESTAMP_FRESH_THRESHOLD_MS=5000

# CCXT WebSocket and polling delays
CCXT_WEBSOCKET_WAIT_DELAY_MS=1000
CCXT_WEBSOCKET_ERROR_DELAY_MS=2000
CCXT_WEBSOCKET_SYMBOL_ERROR_DELAY_MS=5000
CCXT_REST_POLLING_DELAY_MS=1000

# Tier-2 exchange reliability factors
CCXT_BITMART_RELIABILITY=0.85
CCXT_BYBIT_RELIABILITY=0.9
CCXT_GATE_RELIABILITY=0.88
CCXT_KUCOIN_RELIABILITY=0.87
CCXT_PROBIT_RELIABILITY=0.82
CCXT_CRYPTOCOM_RELIABILITY=0.92
CCXT_DEFAULT_RELIABILITY=0.8

# =============================================================================
# AGGREGATION CONFIGURATION
# =============================================================================

# Core aggregation settings
AGGREGATION_MAX_STALENESS_MS=30000
AGGREGATION_WEIGHT_UPDATE_INTERVAL_MS=300000
AGGREGATION_CACHE_TTL_MS=300
AGGREGATION_MAX_CACHE_SIZE=1000
AGGREGATION_FRESH_DATA_THRESHOLD_MS=2000
AGGREGATION_BATCH_PROCESSING_INTERVAL_MS=500
AGGREGATION_PERFORMANCE_BUFFER_SIZE=100

# Aggregation algorithms
AGGREGATION_LAMBDA_DECAY=0.00004
AGGREGATION_OUTLIER_THRESHOLD=0.12
AGGREGATION_PERFORMANCE_TARGET_MS=150
AGGREGATION_MIN_SOURCES=1
AGGREGATION_BATCH_SIZE=50
AGGREGATION_TIER_1_WEIGHT=1.4
AGGREGATION_TIER_2_WEIGHT=1.0

# Aggregation retry settings
AGGREGATION_INITIAL_DELAY_MS=1000
AGGREGATION_MAX_DELAY_MS=30000
AGGREGATION_MAX_ATTEMPTS=10

# Performance optimization
AGGREGATION_FAILURE_COOLDOWN_MS=120000
AGGREGATION_HEAVY_LOAD_PROCESSING_TIME_THRESHOLD_MS=50
AGGREGATION_HEAVY_LOAD_FEED_COUNT_THRESHOLD=10
AGGREGATION_HEAVY_LOAD_INTERVAL_MS=150
AGGREGATION_LIGHT_LOAD_PROCESSING_TIME_THRESHOLD_MS=20
AGGREGATION_LIGHT_LOAD_FEED_COUNT_THRESHOLD=5
AGGREGATION_LIGHT_LOAD_INTERVAL_MS=75

# Exchange weight configuration
AGGREGATION_BINANCE_BASE_WEIGHT=0.28
AGGREGATION_BINANCE_TIER_MULTIPLIER=1.4
AGGREGATION_BINANCE_RELIABILITY_SCORE=0.97
AGGREGATION_COINBASE_BASE_WEIGHT=0.26
AGGREGATION_COINBASE_TIER_MULTIPLIER=1.4
AGGREGATION_COINBASE_RELIABILITY_SCORE=0.96
AGGREGATION_KRAKEN_BASE_WEIGHT=0.22
AGGREGATION_KRAKEN_TIER_MULTIPLIER=1.4
AGGREGATION_KRAKEN_RELIABILITY_SCORE=0.95
AGGREGATION_OKX_BASE_WEIGHT=0.18
AGGREGATION_OKX_TIER_MULTIPLIER=1.4
AGGREGATION_OKX_RELIABILITY_SCORE=0.94
AGGREGATION_CRYPTOCOM_BASE_WEIGHT=0.16
AGGREGATION_CRYPTOCOM_TIER_MULTIPLIER=1.4
AGGREGATION_CRYPTOCOM_RELIABILITY_SCORE=0.92

# =============================================================================
# FAILOVER MANAGER
# =============================================================================

FAILOVER_MAX_FAILOVER_TIME_MS=100
FAILOVER_FAILURE_THRESHOLD=3
FAILOVER_RECOVERY_THRESHOLD=5
FAILOVER_MIN_FAILURE_INTERVAL_MS=10000
FAILOVER_COOLDOWN_MS=5000
FAILOVER_SUBSCRIPTION_TIMEOUT_MS=10000
FAILOVER_MAX_WARNING_MULTIPLIER=2.0
FAILOVER_RETRY_ATTEMPTS=1

# =============================================================================
# ALERTING CONFIGURATION
# =============================================================================

# Email alerting
ALERT_EMAIL_ENABLED=false
ALERT_SMTP_HOST=localhost
ALERT_SMTP_PORT=587
ALERT_SMTP_USERNAME=""
ALERT_SMTP_PASSWORD=""
ALERT_EMAIL_FROM="Alerting Service <alerts@ftso-provider.com>"
ALERT_EMAIL_TO=""

# Webhook alerting
ALERT_WEBHOOK_ENABLED=false
ALERT_WEBHOOK_URL=""
ALERT_WEBHOOK_HEADERS="{}"

# =============================================================================
# DEVELOPMENT & DEBUGGING
# =============================================================================
# These variables are primarily used for development and testing

# Enable debug features
DEBUG_ENABLED=false
DEBUG_VERBOSE_LOGGING=false
DEBUG_PERFORMANCE_TRACKING=true

# Test mode settings
TEST_MODE=false
TEST_MOCK_EXCHANGES=false
TEST_SKIP_VALIDATION=false

# =============================================================================
# SECURITY SETTINGS
# =============================================================================
# Security-related configuration options

# API security
API_RATE_LIMIT_ENABLED=true
API_CORS_ENABLED=true
API_HELMET_ENABLED=true

# Data encryption (if applicable)
ENCRYPTION_ENABLED=false
ENCRYPTION_KEY=""

# =============================================================================
# END OF CONFIGURATION
# =============================================================================